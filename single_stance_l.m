%%% compute forces, GRFs and moments for swing of right leg/stance of left leg
function forces = single_stance_l(q1,q2,q3)
%%%
global L r m MI R2 R3 del2 del3 g
%%%
L2 = L(1);
L3 = L(2);
L4 = L(3);
L5 = L(4);
r2 = r(1);
r3 = r(2);
r4 = r(3);
r5 = r(4);
m1 = m(1);
m2 = m(2);
m3 = m(3);
m4 = m(4);
m5 = m(5);
MI1 = MI(1);
MI2 = MI(2);
MI3 = MI(3);
MI4 = MI(4);
MI5 = MI(5);
%%%
x1 = q1(1);
y1 = q1(2);
tht1 = q1(3);
tht2 = q1(4);
tht3 = q1(5);
tht4 = q1(6);
tht5 = q1(7);
omg1 = q2(1);
omg2 = q2(2);
omg3 = q2(3);
omg4 = q2(4);
omg5 = q2(5);
ax1 = q3(1);
ay1 = q3(2);
alp1 = q3(3);
alp2 = q3(4);
alp3 = q3(5);
alp4 = q3(6);
alp5 = q3(7);

As2=[1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0;0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,...
    0,0;(-1).*R2.*cos(del2+(-1).*tht1),R2.*sin(del2+(-1).*tht1),(-1).* ...
    R3.*cos(del3+tht1),(-1).*R3.*sin(del3+tht1),0,0,0,0,0,0,0,0,1,(-1) ...
    ,(-1),0,0;(-1),0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0;0,(-1),0,0,0,1,0,0, ...
    0,0,0,0,0,0,0,0,0;(-1).*r2.*cos(tht2),(-1).*r2.*sin(tht2),0,0,(-1) ...
    .*(L2+(-1).*r2).*cos(tht2),((-1).*L2+r2).*sin(tht2),0,0,0,0,0,0,0, ...
    1,0,(-1),0;0,0,(-1),0,0,0,1,0,0,0,0,0,0,0,0,0,0;0,0,0,(-1),0,0,0, ...
    1,0,0,0,0,0,0,0,0,0;0,0,(-1).*r3.*cos(tht3),(-1).*r3.*sin(tht3),0, ...
    0,(-1).*(L3+(-1).*r3).*cos(tht3),((-1).*L3+r3).*sin(tht3),0,0,0,0, ...
    0,0,1,0,(-1);0,0,0,0,(-1),0,0,0,0,0,0,0,0,0,0,0,0;0,0,0,0,0,(-1), ...
    0,0,0,0,0,0,0,0,0,0,0;0,0,0,0,(-1).*r4.*cos(tht4),(-1).*r4.*sin( ...
    tht4),0,0,0,0,0,0,0,0,0,1,0;0,0,0,0,0,0,(-1),0,0,0,1,0,0,0,0,0,0; ...
    0,0,0,0,0,0,0,(-1),0,0,0,1,0,0,0,0,0;0,0,0,0,0,0,(-1).*r5.*cos( ...
    tht5),(-1).*r5.*sin(tht5),0,0,(-1).*(L5+(-1).*r5).*cos(tht5),((-1) ...
    .*L5+r5).*sin(tht5),0,0,0,0,1;0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0;0, ...
    0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0];

bs2=[ax1.*m1,ay1.*m1+g.*m1,alp1.*MI1,m2.*(ax1+(-1).*alp1.*R2.*cos( ...
    del2+(-1).*tht1)+(-1).*alp2.*r2.*cos(tht2)+(-1).*omg1.^2.*R2.*sin( ...
    del2+(-1).*tht1)+omg2.^2.*r2.*sin(tht2)),g.*m2+m2.*(ay1+(-1).* ...
    omg1.^2.*R2.*cos(del2+(-1).*tht1)+(-1).*omg2.^2.*r2.*cos(tht2)+ ...
    alp1.*R2.*sin(del2+(-1).*tht1)+(-1).*alp2.*r2.*sin(tht2)),alp2.* ...
    MI2,m3.*(ax1+(-1).*alp1.*R3.*cos(del3+tht1)+(-1).*alp3.*r3.*cos( ...
    tht3)+omg1.^2.*R3.*sin(del3+tht1)+omg3.^2.*r3.*sin(tht3)),g.*m3+ ...
    m3.*(ay1+(-1).*omg1.^2.*R3.*cos(del3+tht1)+(-1).*omg3.^2.*r3.*cos( ...
    tht3)+(-1).*alp1.*R3.*sin(del3+tht1)+(-1).*alp3.*r3.*sin(tht3)), ...
    alp3.*MI3,m4.*(ax1+(-1).*alp1.*R2.*cos(del2+(-1).*tht1)+(-1).* ...
    alp2.*L2.*cos(tht2)+(-1).*alp4.*r4.*cos(tht4)+(-1).*omg1.^2.*R2.* ...
    sin(del2+(-1).*tht1)+L2.*omg2.^2.*sin(tht2)+omg4.^2.*r4.*sin(tht4) ...
    ),g.*m4+m4.*(ay1+(-1).*omg1.^2.*R2.*cos(del2+(-1).*tht1)+(-1).* ...
    L2.*omg2.^2.*cos(tht2)+(-1).*omg4.^2.*r4.*cos(tht4)+alp1.*R2.*sin( ...
    del2+(-1).*tht1)+(-1).*alp2.*L2.*sin(tht2)+(-1).*alp4.*r4.*sin( ...
    tht4)),alp4.*MI4,m5.*(ax1+(-1).*alp1.*R3.*cos(del3+tht1)+(-1).* ...
    alp3.*L3.*cos(tht3)+(-1).*alp5.*r5.*cos(tht5)+omg1.^2.*R3.*sin( ...
    del3+tht1)+L3.*omg3.^2.*sin(tht3)+omg5.^2.*r5.*sin(tht5)),g.*m5+ ...
    m5.*(ay1+(-1).*omg1.^2.*R3.*cos(del3+tht1)+(-1).*L3.*omg3.^2.*cos( ...
    tht3)+(-1).*omg5.^2.*r5.*cos(tht5)+(-1).*alp1.*R3.*sin(del3+tht1)+ ...
    (-1).*alp3.*L3.*sin(tht3)+(-1).*alp5.*r5.*sin(tht5)),alp5.*MI5,0, ...
    0]';

forces = As2\bs2;

end